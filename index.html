<!doctype html>
<html>
<body>
  <h1>404friends</h1>

  <div id="inviteBox">
    <input id="invite" placeholder="invite code">
    <button id="inviteBtn">Enter</button>
    <p id="inviteMsg"></p>
  </div>

  <div id="loginBox" style="display:none;">
    <input id="email" placeholder="email">
    <input id="password" type="password" placeholder="password">
    <button id="loginBtn">Login</button>
    <button id="signupBtn">Sign up</button>
    <p id="msg"></p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const INVITE = "404FRIENDS2026";

    const sb = window.supabase.createClient(
      "https://tlxidqqcnpfxirmokhol.supabase.co",
      "sb_publishable_Xs-Tc9ZbdW5TwXVxlEdIqA_49yuVrS7"
    );

    function okInvite(code) {
      return (code || "").trim().toUpperCase() === INVITE;
    }

    function showLogin() {
      document.getElementById("inviteBox").style.display = "none";
      document.getElementById("loginBox").style.display = "block";
    }

    // If already validated this browser, skip invite
    if (localStorage.getItem("invite_ok") === "1") showLogin();

    document.getElementById("inviteBtn").onclick = () => {
      const code = document.getElementById("invite").value;
      if (!okInvite(code)) {
        document.getElementById("inviteMsg").textContent = "Invalid invite code";
        return;
      }
      localStorage.setItem("invite_ok", "1");
      showLogin();
    };

    async function doLogin() {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;

      const { error } = await sb.auth.signInWithPassword({ email, password });
      document.getElementById("msg").textContent = error ? error.message : "Logged in";
      if (!error) window.location.href = "feed.html";
    }

    async function doSignup() {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;

      const { error } = await sb.auth.signUp({ email, password });
      document.getElementById("msg").textContent = error
        ? error.message
        : "Account created. Now click Login.";
    }

    document.getElementById("loginBtn").onclick = doLogin;
    document.getElementById("signupBtn").onclick = doSignup;

    // Enter key submits login
    document.getElementById("password").addEventListener("keydown", (e) => {
      if (e.key === "Enter") doLogin();
    });
  </script>
</body>
</html>
